!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(t){this.rows=t[0],this.cols=t[1],this._board=Array(this.cols*this.rows);for(let t=0;t<this.length;t++)this._board[t]=new o}get length(){return this._board.length}_toIndex(t){const[e,i]=t;if(e<0||e>=this.rows||i<0||i>=this.cols)throw RangeError(`Board: item [${e}, ${i}] is out of range, it must be >= [0, 0] and < [${this.rows}, ${this.cols}]`);return e*this.cols+i}getCell(t){return this._board[this._toIndex(t)]}getItem(t){return this.getCell(t).token}setItem(t,e){this.getCell(t).token=e}destroy(){this._board.forEach((t,e,i)=>{t.destroy(),i[e]=null})}toString(){let t="";return this._board.forEach((e,i)=>{i&&i%this.cols==0&&(t+="\n"),t+=` ${String(e)}`}),t}}class o{constructor(t=null,e=null){this.capacity=100,this.label=t,this.token=e,this.x=null,this.y=null}destroy(){this.token=null}toString(){return String(this.token)}draw(t){const e=t.ctx;e.font=t.font,e.fillStyle=t.textFillStyle,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.fillText(String(this.label||""),this.x+t.localTextX,this.y+t.localTextY,t.textMaxWidth)}}class n{constructor(){this.weight=0}draw(){throw TypeError("Token.draw: is an abstract method. Must be overridden by subclasses")}static create(t,e){const i=typeof t;return"number"===i?new a(t,e):"string"===i?new h(t,e):null}static toRaw(t){return t&&"value"in t?t.value:null}}class a extends n{constructor(t,e){super(),this.x=e.x,this.y=e.y,this.config=e.baseConfig,this.weight=60,this.value=t}toString(){return String(this.value)}draw(t){const e=this.config.ctx,i=this.config.tokenSize,s=this.config.rectRound,o=this.config._roundRect,n=this.x,a=this.y;e.shadowBlur=t.tokenShadowBlur,e.shadowColor=t.tokenShadowColor,e.shadowOffsetX=t.tokenShadowOffsetX,e.shadowOffsetY=t.tokenShadowOffsetY,e.fillStyle=t.tokenFillColor,o(e,n,a,i,i,s,!0,!1),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.strokeStyle=t.tokenBorderColor,e.lineWidth=t.tokenBorderWidth,o(e,n,a,i,i,s,!1,!0),e.font=t.font,e.fillStyle=t.textFillStyle,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.fillText(String(this.value),n+t.localTextX,a+t.localTextY,t.textMaxWidth)}}class h extends n{constructor(t,e){if(super(),Object.values(this.states).indexOf(t)<0)throw new Error('PassiveToken.constructor: the "value" ['+t+"] should be an existing state ("+Object.values(this.states).join(", ")+")");this.x=e.x,this.y=e.y,this.config=e.baseConfig,this.weight=80,this.value=t,this.state=t}toString(){return String(this.value)}_drawSingleArrow(t,e,i,s){t.beginPath(),t.moveTo(...e),t.lineTo(...i),t.lineTo(...s),t.stroke(),t.closePath()}_drawSingleArc(t,e,i){t.beginPath(),t.arc(...e,i,0,2*Math.PI),t.fill(),t.closePath()}draw(t){const e=this.config.ctx,i=this.config.tokenSize,s=this.config.rectRound,o=this.config._roundRect,n=this.x,a=this.y,h=n+t.center,l=a+t.center,r=t.figureRadius,c=r/2;switch(e.fillStyle=t.tokenFillColor,o(e,n,a,i,i,s,!0,!1),e.lineCap=t.lineCap,e.lineWidth=t.lineWidth,e.strokeStyle=t.arrowColor,e.fillStyle=t.arcFill,this.state){case this.states.BOTTOM:this._drawSingleArrow(e,[h-r,l],[h,l+r],[h+r,l]),this._drawSingleArc(e,[h,l-c],c);break;case this.states.TOP:this._drawSingleArrow(e,[h-r,l],[h,l-r],[h+r,l]),this._drawSingleArc(e,[h,l+c],c);break;case this.states.LEFT:this._drawSingleArrow(e,[h,l-r],[h-r,l],[h,l+r]),this._drawSingleArc(e,[h+c,l],c);break;case this.states.RIGHT:this._drawSingleArrow(e,[h,l-r],[h+r,l],[h,l+r]),this._drawSingleArc(e,[h-c,l],c);break;case this.states.ALL:this._drawSingleArrow(e,[h-c,l-r],[h,l-r-c],[h+c,l-r]),this._drawSingleArrow(e,[h-c,l+r],[h,l+r+c],[h+c,l+r]),this._drawSingleArrow(e,[h-r,l-c],[h-r-c,l],[h-r,l+c]),this._drawSingleArrow(e,[h+r,l-c],[h+r+c,l],[h+r,l+c]),e.beginPath(),e.strokeStyle=t.arcFill,e.moveTo(h,l-c),e.lineTo(h,l+c),e.moveTo(h-c,l),e.lineTo(h+c,l),e.stroke(),e.closePath();break;case this.states.VERTICAL:this._drawSingleArrow(e,[h-c,l-r],[h,l-r-c],[h+r,l-c]),this._drawSingleArrow(e,[h-r,l+c],[h,l+r+c],[h+c,l+r]),this._drawSingleArc(e,[h,l],c);break;case this.states.HORIZONTAL:this._drawSingleArrow(e,[h-c,l-r],[h-r-c,l],[h-r,l+c]),this._drawSingleArrow(e,[h+r,l-c],[h+r+c,l],[h+c,l+r]),this._drawSingleArc(e,[h,l],c);break;case this.states.NONE:this._drawSingleArc(e,[h,l],r+c),e.beginPath(),e.strokeStyle=t.xLineColor,e.moveTo(h-c,l-c),e.lineTo(h+c,l+c),e.moveTo(h+c,l-c),e.lineTo(h-c,l+c),e.stroke(),e.closePath()}}}Object.assign(h.prototype,{states:{NONE:"none",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",HORIZONTAL:"horizontal",VERTICAL:"vertical",ALL:"all"}});class l{constructor(t=0){this._init=t,this.steps=t}incr(){this.steps+=1}start(){this.steps=this._init}draw(t){const e=t.ctx;e.font=t.font,e.fillStyle=t.textFillStyle,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.fillText("#"+this.toString(),t.x,t.y)}toString(){return this.steps}}class r{constructor(){}start(){this.startStamp=(new Date).getTime(),this.currentStamp=this.startStamp,this.pauseTime=0,this.pauseStamp=0,this.pauseTime=0}pause(){this.pauseStamp=(new Date).getTime()}unpause(){this.pauseTime+=(new Date).getTime()-this.pauseStamp}draw(t){const e=t.ctx;e.font=t.font,e.fillStyle=t.textFillStyle,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.fillText(this.toString(),t.x,t.y)}update(){this.currentStamp=(new Date).getTime()}getSeconds(){return Math.floor((this.currentStamp-this.startStamp-this.pauseTime)/1e3)}getTimeArray(){const t=this.getSeconds();return[Math.floor(t/3600),Math.floor(t/60),t%60]}toString(){return this.getTimeArray().map((t,e)=>e&&t<10?`0${t}`:`${t}`).join(":")}}function c(t,e){return void 0===e&&(e=t,t=0),Math.floor(Math.random()*(e-t)+t)}var d=class{constructor(t,e){this.PLAY="play",this.CLOSE="close",this.RELOAD="reload",this.VICTORY="victory",this.cellSize=0,Object.assign(this,e),this.board=new s(t),this.timer=new r,this.counter=new l,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.backgroundColor="#fff",this.hoverToken=null,this.selected=null,this.eventQueue=[],this.changed=!0,this.paused=!1,this.state=this.PLAY,this.hoverButton=null,this.baseFontSize=Math.floor(.3*this.cellSize),this.panelFontSize=Math.floor(.9*this.baseFontSize),this.cellFont=`900 ${this.baseFontSize}px 'Montserrat', serif`,this.cellPicFont=`${2*this.baseFontSize}px 'Icons'`,this.panelFont=`bold ${this.panelFontSize}px 'Montserrat', serif`,this.canvasPadding=Math.floor(.05*this.cellSize),this.cellPadding=Math.floor(.05*this.cellSize),this.rectRound=Math.floor(.07*this.cellSize),this.tokenSize=this.cellSize-2*this.cellPadding,this.panelSize=Math.floor(.7*this.cellSize),this.panelBasePadding=this.canvasPadding+this.cellPadding,this.panelButtonSize=this.panelFontSize,this.panelButtonMargin=.4*this.panelButtonSize,this.canvas.width=this.cellSize*this.board.cols+2*this.canvasPadding,this.canvas.height=this.cellSize*this.board.rows+2*this.canvasPadding+this.panelSize,this.frameCallback=this.frame.bind(this),this.computeStyles(),this.attachEvents()}mount(t){document.querySelector(t).appendChild(this.canvas)}computeStyles(){this.cellConfig=Object.freeze({ctx:this.ctx,font:this.cellFont,textFillStyle:"#999",textAlign:"center",textBaseline:"middle",textMaxWidth:Math.floor(.7*this.cellSize),localTextX:Math.floor(this.cellSize/2),localTextY:Math.floor(this.cellSize/1.8)}),this.baseConfig=Object.freeze({ctx:this.ctx,tokenSize:this.tokenSize,rectRound:this.rectRound,_roundRect:this._roundRect}),this.activeConfig=Object.freeze({tokenBorderColor:"#bbb",tokenBorderWidth:Math.floor(.02*this.tokenSize),tokenFillColor:"#ddd",tokenShadowColor:"#999",tokenShadowBlur:Math.floor(.05*this.tokenSize),tokenShadowOffsetX:Math.floor(.04*this.tokenSize),tokenShadowOffsetY:Math.floor(.04*this.tokenSize),font:this.cellFont,textFillStyle:"#555",textAlign:"center",textBaseline:"middle",textMaxWidth:Math.floor(.75*this.tokenSize),localTextX:Math.floor(this.tokenSize/2),localTextY:Math.floor(this.tokenSize/1.8)}),this.PassiveConfig=Object.freeze({tokenFillColor:"#fff",lineCap:"round",lineWidth:Math.floor(.09*this.tokenSize),arrowColor:"#777",xLineColor:"#fff",arcFill:"#bbb",figureRadius:Math.floor(.2*this.tokenSize),center:Math.floor(this.tokenSize/2)}),this.timerConfig=Object.freeze({ctx:this.ctx,x:Math.floor(this.canvasPadding+this.cellPadding),y:Math.floor(.6*this.panelSize),font:this.panelFont,textFillStyle:"#666",textAlign:"left",textBaseline:"middle"}),this.counterConfig=Object.freeze({ctx:this.ctx,x:Math.floor(this.canvas.width/2),y:Math.floor(.6*this.panelSize),font:this.panelFont,textFillStyle:"#666",textAlign:"center",textBaseline:"middle"}),this.panelConfig=Object.freeze({ctx:this.ctx,panelBackground:"#fff",bottomLineY:Math.floor(.99*this.panelSize),bottomLineWidth:Math.floor(.04*this.cellSize),bottomLineStrokeStyle:"#666",iconRadius:Math.floor(.45*this.panelButtonSize),iconLineWidth:Math.floor(.15*this.panelButtonSize),iconStrokeStyle:"#bbb",iconCenterY:Math.floor(.55*this.panelSize),closeCenterX:Math.floor(this.canvas.width-(.5*this.panelButtonSize+this.panelBasePadding)),reloadCenterX:Math.floor(this.canvas.width-(1.5*this.panelButtonSize+this.panelBasePadding+this.panelButtonMargin)),reloadCircleRads:[.3*Math.PI,1.85*Math.PI],pauseCenterX:Math.floor(this.canvas.width-(2.5*this.panelButtonSize+this.panelBasePadding+2*this.panelButtonMargin)),pauseIconFill:"#bbb",hoverIconStyle:"#999"})}attachEvents(){this.canvas.addEventListener("mouseover",function(t){const e=function(t){this.eventQueue.push(this.onHover.bind(this,t))}.bind(this);this.canvas.addEventListener("mouseleave",function(t){this.canvas.removeEventListener("mousemove",e,!1),this.hoverToken=null,this.hoverButton=null,this.changed=!0}.bind(this),!1),this.canvas.addEventListener("mousemove",e,!1)}.bind(this),!1),this.canvas.addEventListener("click",function(t){this.eventQueue.push(this.onClick.bind(this,t))}.bind(this),!1),this.canvas.addEventListener("touchstart",function(t){this.eventQueue.push(this.onHover.bind(this,t)),this.eventQueue.push(this.onTouch.bind(this,t))}.bind(this),!1),this.canvas.addEventListener("touchend",function(t){this.eventQueue.push(this.onTouch.bind(this,t)),this.hoverToken=null}.bind(this),!1)}onHover(t){const e=this.canvasPixelCoords(t),i=this.hoverTokenCoords(e),s=this.hoverButtonCoords(e),o=i||s?"pointer":"default";this.hoverToken=i,this.hoverButton=s,this.canvas.style.cursor=o}onClick(t){const e=this.canvasPixelCoords(t),i=this.hoverTokenCoords(e),s=this.hoverButtonCoords(e);if(i||s)if(i&&!this.paused){const t=this.board.getItem(i);t instanceof a?this.selected=i:null===t&&this.selected&&this.isValidMove(this.selected,i)&&(this.change(this.selected,i),this.selected=null,this.eventQueue.push(this.onChange.bind(this)),this.eventQueue.push(this.counter.incr.bind(this.counter)))}else s&&("pause"===s?(this.paused?this.timer.unpause():this.timer.pause(),this.paused=!this.paused):this.state=this[s.toUpperCase()])}onTouch(t){const e=this.canvasPixelCoords(t),i=this.hoverTokenCoords(e);if(i&&!this.paused){const t=this.board.getItem(i);t instanceof a?this.selected=i:null===t&&this.selected&&this.isValidMove(this.selected,i)&&(this.change(this.selected,i),this.selected=null,this.eventQueue.push(this.onChange.bind(this)),this.eventQueue.push(this.counter.incr.bind(this.counter)))}}onChange(){this.isComplete()&&(this.state=this.VICTORY)}indexToCoord(t){return[Math.floor(t/this.board.cols),t%this.board.cols]}canvasPixelCoords(t){const e=t.target,i=e.offsetLeft,s=e.offsetTop;let o,n;return"touchstart"===t.type||"touchend"===t.type?(o=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(o=t.pageX,n=t.pageY),[o-i,n-s]}cellPixelCoords(t){const[e,i]=t;return[i*this.cellSize+this.canvasPadding,e*this.cellSize+this.canvasPadding+this.panelSize]}tokenPixelCoords(t){const[e,i]=this.cellPixelCoords(t);return[e+this.cellPadding,i+this.cellPadding]}hoverTokenCoords(t){const e=this.canvasPadding,i=this.canvas.height-e,s=this.canvas.width-e,o=this.cellPadding,n=this.tokenSize,a=this.panelSize;if(t[0]<e||t[1]<e+a||t[0]>s||t[1]>i)return null;const h=(t[0]-e)%(n+2*o),l=(t[1]-(e+a))%(n+2*o),r=Math.floor((t[0]-e)/(n+2*o)),c=Math.floor((t[1]-(e+a))/(n+2*o));return h>o&&l>o&&h<n+Math.floor(1.4*o)&&l<n+Math.floor(1.4*o)?[c,r]:null}hoverButtonCoords(t){const e=this.canvasPadding,i=this.canvas.width-e,s=this.panelSize;if(t[0]<this.canvas.width/2||t[1]<e||t[0]>i||t[1]>s)return null;const o=this.panelConfig,n=1.2*o.iconRadius,a=2*n,h=o.closeCenterX-n,l=o.iconCenterY-n,r=this.panelButtonSize+this.panelButtonMargin,c=["close","reload","pause"];for(let e=0,i=c.length;e<i;e++){const i=h-r*e,s=l;if(t[0]>i&&t[0]<i+a&&t[1]>s&&t[1]<s+a)return c[e]}return null}isComplete(){const t=this.board,e=t.length;for(let i=0;i<e;i++){const e=t.getCell(this.indexToCoord(i)),s=e.token;if(e.label!==(s?s.value:s))return!1}return!0}isValidMove(t,e){if(t[0]!==e[0]&&t[1]!==e[1])return!1;const i=t[0]===e[0]?0:t[0]<e[0]?1:-1,s=t[1]===e[1]?0:t[1]<e[1]?1:-1,o=[t[0]+i,t[1]+s];for(;o[0]!==e[0]||o[1]!==e[1];){if(!this.canCrossIt(t,o))return!1;o[0]+=i,o[1]+=s}return!0}canCrossIt(t,e){const i=this.board.getItem(t),s=this.board.getCell(e),o=s.token;let n=0;if(o)if(o instanceof h)switch(o.state){case o.states.NONE:n=80;break;case o.states.ALL:n=40;break;case o.states.BOTTOM:n=t[0]<e[0]&&t[1]===e[1]?40:80;break;case o.states.TOP:n=t[0]>e[0]&&t[1]===e[1]?40:80;break;case o.states.LEFT:n=t[0]===e[0]&&t[1]>e[1]?40:80;break;case o.states.RIGHT:n=t[0]===e[0]&&t[1]<e[1]?40:80;break;case o.states.HORIZONTAL:n=t[0]===e[0]?40:80;break;case o.states.VERTICAL:n=t[1]===e[1]?40:80}else n=o.weight;return s.capacity-n-i.weight>=0}change(t,e){const i=this.board,s=this.board.getItem(t),o=this.board.getItem(e),a=this.tokenPixelCoords(t),h=this.tokenPixelCoords(e);i.setItem(t,o),i.setItem(e,s),o&&o instanceof n&&(o.x=a[0],o.y=a[1]),s&&s instanceof n&&(s.x=h[0],s.y=h[1])}_roundRect(t,e,i,s,o,n=5,a=!0,h=!0){if("number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var l={tl:0,tr:0,br:0,bl:0};for(var r in l)n[r]=n[r]||l[r]}t.beginPath(),t.moveTo(e+n.tl,i),t.lineTo(e+s-n.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+n.tr),t.lineTo(e+s,i+o-n.br),t.quadraticCurveTo(e+s,i+o,e+s-n.br,i+o),t.lineTo(e+n.bl,i+o),t.quadraticCurveTo(e,i+o,e,i+o-n.bl),t.lineTo(e,i+n.tl),t.quadraticCurveTo(e,i,e+n.tl,i),t.closePath(),a&&t.fill(),h&&t.stroke()}shuffle(t){let e,i,s;const o=this.board.length-1;for(;t--;){do{do{e=this.indexToCoord(c(o)),s=this.board.getItem(e)}while(s instanceof h);do{i=this.indexToCoord(c(o)),s=this.board.getItem(i)}while(s instanceof h)}while(e[0]===i[0]&&e[1]===i[1]);this.change(e,i)}}destroy(){delete this.frameCallback,delete this._data,delete this.ctx,delete this.baseConfig,delete this.activeConfig,delete this.passiveConfig,delete this.panelConfig,delete this.counterConfig,delete this.timerConfig,this.board.destroy(),delete this.board,this.canvas.parentNode.removeChild(this.canvas),delete this.canvas,this.onclose&&this.onclose()}load(t){if(!Array.isArray(t)||t.length!==this.board.length)throw RangeError(`Cells.load: the argument must be an Array[ ${this.board.length} ]`);this._data=t;const e=this.baseConfig;t.forEach((t,i)=>{const s=this.indexToCoord(i),[o,a]=this.cellPixelCoords(s),[h,l]=this.tokenPixelCoords(s),r=this.board.getCell(s);r.label=t,r.x=o,r.y=a,r.token=n.create(t,{x:h,y:l,baseConfig:e})})}clear(){const t=this.ctx;t.shadowBlur=0,t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.canvas.width,this.canvas.height)}drawResults(){this.clear();const t=this.ctx,e=Math.floor(this.canvas.width/2),i=Math.floor(.3*this.cellSize);t.textAlign="center",t.textBaseline="middle",t.fillStyle="#666",t.font=this.cellFont;let s=e,o=.5*this.cellSize;t.fillText("Results",s,o),t.lineWidth=.02*this.cellSize,t.beginPath(),t.strokeStyle="#bbb",t.moveTo(0,1.8*o),t.lineTo(this.canvas.width,1.3*o),t.stroke(),t.closePath(),t.font=this.panelFont,t.fillStyle="#777",o=1.2*this.cellSize,s=e-i,t.textAlign="right",t.fillText("Time:",s,o),s=e+i,t.textAlign="left",t.fillText(this.timer.toString(),s,o),o=1.5*this.cellSize,s=e-i,t.textAlign="right",t.fillText("Steps:",s,o),s=e+i,t.textAlign="left",t.fillText(this.counter.toString(),s,o),o=2.2*this.cellSize,s=e,t.font=this.cellFont,t.fillStyle="#666",t.textAlign="center",t.fillText("Click to exit!",s,o),this.canvas.addEventListener("click",()=>{this.destroy()})}drawPanel(t){const e=t.ctx,i=t.iconCenterY,s=this.hoverButton,o=t.iconStrokeStyle,n=t.hoverIconStyle;let a=t.closeCenterX,h=t.iconRadius;this.ctx.fillStyle=t.panelBackground,this.ctx.fillRect(0,0,this.canvas.width,this.panelSize),e.lineWidth=t.bottomLineWidth,e.strokeStyle=t.bottomLineStrokeStyle,e.beginPath(),e.moveTo(0,t.bottomLineY),e.lineTo(this.canvas.width,t.bottomLineY),e.stroke(),e.closePath(),e.lineWidth=t.iconLineWidth,e.strokeStyle="close"===s?n:o,e.beginPath(),e.moveTo(a-h,i-h),e.lineTo(a+h,i+h),e.moveTo(a-h,i+h),e.lineTo(a+h,i-h),e.stroke(),e.closePath(),a=t.reloadCenterX,e.strokeStyle="reload"===s?n:o,e.beginPath(),e.arc(a,i,h,...t.reloadCircleRads),e.stroke(),e.closePath();const l=Math.floor(.4*h),r="pause"===s?n:o;a=t.pauseCenterX,e.beginPath(),this.paused?(e.fillStyle=r,e.moveTo(a-h,i-h),e.lineTo(a+h,i),e.lineTo(a-h,i+h),e.fill()):(e.strokeStyle=r,e.moveTo(a-l,i-h),e.lineTo(a-l,i+h),e.moveTo(a+l,i-h),e.lineTo(a+l,i+h),e.stroke()),e.closePath()}drawPausedBoard(){this.ctx.font=this.cellFont,this.ctx.fillText("Paused",Math.floor(this.canvas.width/2),Math.floor(this.canvas.height/2))}draw(){if(this.changed)if(this.changed=!1,this.clear(),this.drawPanel(this.panelConfig),this.timer.draw(this.timerConfig),this.counter.draw(this.counterConfig),this.paused)this.drawPausedBoard();else for(let t=0,e=this.board.length;t<e;t++){const e=this.indexToCoord(t),i=this.board.getCell(e),s=i.token;if(i.draw(this.cellConfig),null===s)continue;const o={};let n={};if(s instanceof a){n=this.activeConfig;const t=this.selected;t&&t[0]===e[0]&&t[1]===e[1]&&(o.tokenFillColor="#8f8f8f");const i=this.hoverToken;i&&i[0]===e[0]&&i[1]===e[1]&&(o.tokenBorderColor="#aaa",o.tokenBorderWidth=Math.floor(.05*this.tokenSize))}else s instanceof h&&(n=this.PassiveConfig);Object.keys(o).length&&(n=Object.assign({},n,o)),s.draw(n)}}update(){const t=this.eventQueue,e=this.timer,i=e.getSeconds();for(this.paused||e.update(),(t.length||e.getSeconds()!==i)&&(this.changed=!0);t.length;){const e=t.shift();if(!e)return;e()}}frame(){const t=this.state;this.update(),this.draw(),t===this.PLAY?this.frameDescriptor=window.requestAnimationFrame(this.frameCallback):(window.cancelAnimationFrame(this.frameDescriptor),t===this.CLOSE?this.destroy():t===this.RELOAD?(this.hoverToken=null,this.selected=null,this.changed=!0,this.paused=!1,this.state=this.PLAY,this.eventQueue.length=0,this.load(this._data),this.run()):t===this.VICTORY&&this.drawResults())}run(){for(this.onopen&&this.onopen();this.isComplete();)this.shuffle(Math.floor(this.board.length/2));this.state=this.PLAY,this.paused=!1,this.counter.start(),this.timer.start(),this.frameDescriptor=window.requestAnimationFrame(this.frameCallback)}};var u=class{constructor(t,e){if(this.PLAY="play",this.RELOAD="reload",this.CLOSE="close",this.SAVE="save",this.MAX_LINE_VALUE=9,this.MIN_LINE_VALUE=3,this.MIN_SIZE=12,this.initialSize=[4,3],this.initialBoard=Array(this.initialSize[0]*this.initialSize[1]).fill(null),this.state=null,this.cellSize=0,e&&Object.assign(this,e),t||(t=this.initialSize),t[0]*t[1]<this.MIN_SIZE)throw new RangeError(`CellsBuilder: board size area "${t[0]*t[1]}" should be great or equal to "${this.MIN_SIZE}"`);if(t[0]<this.MIN_LINE_VALUE||t[1]<this.MIN_LINE_VALUE)throw new RangeError(`CellsBuilder: board size "[${t[0]}, ${t[1]}]" should be contains values greater or equal "${this.MIN_LINE_VALUE}"`);this.board=new s(t),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.backgroundColor="#fff",this.hoverToken=null,this.selected=null,this.eventQueue=[],this.changed=!0,this.hoverButton=null,this.baseFontSize=Math.floor(.3*this.cellSize),this.panelFontSize=Math.floor(.9*this.baseFontSize),this.cellFont=`900 ${this.baseFontSize}px 'Montserrat', serif`,this.panelFont=`bold ${this.panelFontSize}px 'Montserrat', serif`,this.canvasPadding=Math.floor(.05*this.cellSize),this.cellPadding=Math.floor(.05*this.cellSize),this.rectRound=Math.floor(.07*this.cellSize),this.tokenSize=this.cellSize-2*this.cellPadding,this.panelSize=Math.floor(1.6*this.cellSize),this.panelBasePadding=this.canvasPadding+this.cellPadding,this.panelButtonSize=Math.floor(.35*this.cellSize),this.arrowButtonWidth=Math.floor(.5*this.cellSize),this.arrowButtonHeight=this.cellSize,this.panelCurrentToken=0,this.panelSelectedToken=null,this.computeCanvasSize(),this.buttonRadius=Math.floor(.5*this.panelButtonSize),this.buttonPadding=Math.floor(.3*this.panelButtonSize),this.frameCallback=this.frame.bind(this),this.computeStyles(),this.attachEvents(),this.computePanelButtons()}mount(t){document.querySelector(t).appendChild(this.canvas)}computeCanvasSize(){this.canvas.width=this.cellSize*this.board.cols+2*this.canvasPadding,this.canvas.height=this.cellSize*this.board.rows+2*this.canvasPadding+this.panelSize}computePanelButtons(){let t=[Math.floor(this.canvas.width/2)-Math.floor(.55*this.cellSize)-this.panelButtonSize,Math.floor(.99*this.panelSize)-this.panelBasePadding-this.panelButtonSize,this.panelButtonSize,this.panelButtonSize],e=[t[0],t[1]-2*this.panelButtonSize,this.panelButtonSize,this.panelButtonSize],i=[t[0]-Math.floor(1.6*this.panelButtonSize),t[1],this.panelButtonSize,this.panelButtonSize],s=[i[0],e[1],this.panelButtonSize,this.panelButtonSize],o=[this.canvas.width-this.panelBasePadding-Math.floor((this.canvas.width-(Math.floor(this.canvas.width/2)-Math.floor(.55*this.cellSize)+2*this.panelBasePadding))/2)-this.cellSize,this.panelSize-this.cellSize-this.panelBasePadding,this.arrowButtonWidth,this.arrowButtonHeight],a=[o[0]+this.arrowButtonWidth+this.cellPadding,o[1]+this.cellPadding,this.tokenSize,this.tokenSize],l=[o[0]+this.arrowButtonWidth+this.cellSize,o[1],this.arrowButtonWidth,this.arrowButtonHeight],r=[l[0]+this.arrowButtonWidth-this.panelButtonSize,Math.floor(.15*this.panelButtonSize),this.panelButtonSize,this.panelButtonSize],c=[r[0]-(this.panelButtonSize+Math.floor(.5*this.buttonPadding)),r[1],this.panelButtonSize,this.panelButtonSize],d=[c[0]-(this.panelButtonSize+Math.floor(.5*this.buttonPadding)),c[1],this.panelButtonSize,this.panelButtonSize];this.buttons={decreaseRowsButton:t,increaseRowsButton:e,decreaseColsButton:i,increaseColsButton:s,leftArrowButton:o,setToken:a,rightArrowButton:l,closeButton:r,reloadButton:c,saveButton:d};const u={x:a[0],y:a[1],baseConfig:this.baseConfig};this.panelTokens=[1,...Object.values(h.prototype.states)].map(t=>n.create(t,u))}refreshUI(){this.computeCanvasSize(),this.computePanelButtons()}computeStyles(){this.cellConfig=Object.freeze({ctx:this.ctx,font:this.cellFont,textFillStyle:"#999",textAlign:"center",textBaseline:"middle",textMaxWidth:Math.floor(.7*this.cellSize),localTextX:Math.floor(this.cellSize/2),localTextY:Math.floor(this.cellSize/1.8)}),this.baseConfig=Object.freeze({ctx:this.ctx,tokenSize:this.tokenSize,rectRound:this.rectRound,_roundRect:this._roundRect}),this.activeConfig=Object.freeze({tokenBorderColor:"#bbb",tokenBorderWidth:Math.floor(.02*this.tokenSize),tokenFillColor:"#ddd",tokenShadowColor:"#999",tokenShadowBlur:Math.floor(.05*this.tokenSize),tokenShadowOffsetX:Math.floor(.04*this.tokenSize),tokenShadowOffsetY:Math.floor(.04*this.tokenSize),font:this.cellFont,textFillStyle:"#555",textAlign:"center",textBaseline:"middle",textMaxWidth:Math.floor(.75*this.tokenSize),localTextX:Math.floor(this.tokenSize/2),localTextY:Math.floor(this.tokenSize/1.8)}),this.passiveConfig=Object.freeze({tokenFillColor:"#fff",lineCap:"round",lineWidth:Math.floor(.09*this.tokenSize),arrowColor:"#777",xLineColor:"#fff",arcFill:"#bbb",figureRadius:Math.floor(.2*this.tokenSize),center:Math.floor(this.tokenSize/2)}),this.panelConfig=Object.freeze({ctx:this.ctx,panelBackground:"#fff",bottomLineY:Math.floor(.99*this.panelSize),bottomLineWidth:Math.floor(.04*this.cellSize),bottomLineStrokeStyle:"#666",fontColor:"#555",buttonColor:"#aaa",hoverButtonColor:"#888",iconColor:"#eee",iconLineWidth:Math.floor(.15*this.panelButtonSize),arrowWidth:Math.floor(.5*this.arrowButtonWidth),arrowHeight:this.arrowButtonWidth,arrowLineWidth:Math.floor(.25*this.arrowButtonWidth)})}attachEvents(){this.canvas.addEventListener("mouseover",function(t){const e=function(t){this.eventQueue.push(this.onHover.bind(this,t))}.bind(this);this.canvas.addEventListener("mouseleave",function(t){this.canvas.removeEventListener("mousemove",e,!1),this.hoverToken=null,this.hoverButton=null,this.changed=!0}.bind(this),!1),this.canvas.addEventListener("mousemove",e,!1)}.bind(this),!1),this.canvas.addEventListener("click",function(t){this.eventQueue.push(this.onClick.bind(this,t))}.bind(this),!1)}onHover(t){const e=this.canvasPixelCoords(t),i=this.hoverTokenCoords(e),s=this.hoverButtonName(e),o=i||s?"pointer":"default";this.hoverToken=i,this.hoverButton=s,this.canvas.style.cursor=o}onClick(t){const e=this.canvasPixelCoords(t),i=this.hoverTokenCoords(e),o=this.hoverButtonName(e);if(i||o)if(i)if(this.panelSelectedToken){const t=this.tokenPixelCoords(i),e={x:t[0],y:t[1],baseConfig:this.baseConfig},s=n.toRaw(this.panelSelectedToken),o=n.create(s,e);this.board.setItem(i,o),this.eventQueue.push(this.onChange.bind(this))}else this.selected?(this.selected[0]===i[0]&&this.selected[1]===i[1]?this.board.setItem(i,null):this.change(this.selected,i),this.selected=null,this.eventQueue.push(this.onChange.bind(this))):this.board.getItem(i)&&(this.selected=i);else if(o)switch(o){case"increaseColsButton":if(this.board.cols<this.MAX_LINE_VALUE){const t=this.save(),e=t.cols+1,i=new s([t.rows,e]),o=[];for(let s=0;s<i.length;s++)o[s]=(s+1)%e!=0?t.map.shift():null;this.board.destroy(),this.board=i,this.refreshUI(),this.load(o)}break;case"decreaseColsButton":if(this.board.length-this.board.rows>=this.MIN_SIZE&&this.board.cols>this.MIN_LINE_VALUE){const t=this.save(),e=t.cols-1,i=new s([t.rows,e]),o=[];for(let s=0;s<i.length;s++)o[s]=t.map.shift(),(s+1)%e==0&&t.map.shift();this.board.destroy(),this.board=i,this.refreshUI(),this.load(o)}break;case"increaseRowsButton":if(this.board.rows<this.MAX_LINE_VALUE){const t=this.save(),e=t.rows+1,i=new s([e,t.cols]),o=[...t.map,...Array(t.cols).fill(null)];this.board.destroy(),this.board=i,this.refreshUI(),this.load(o)}break;case"decreaseRowsButton":if(this.board.length-this.board.cols>=this.MIN_SIZE&&this.board.rows>this.MIN_LINE_VALUE){const t=this.save(),e=t.rows-1,i=new s([e,t.cols]),o=[...t.map];o.length-=t.cols,this.board.destroy(),this.board=i,this.refreshUI(),this.load(o)}break;case"leftArrowButton":this.panelCurrentToken=this.panelCurrentToken>0?this.panelCurrentToken-1:this.panelTokens.length-1,this.panelSelectedToken=null;break;case"setToken":this.selected&&(this.selected=null),this.panelSelectedToken=this.panelSelectedToken?null:this.panelTokens[this.panelCurrentToken];break;case"rightArrowButton":this.panelCurrentToken=(this.panelCurrentToken+1)%this.panelTokens.length,this.panelSelectedToken=null;break;case"closeButton":this.state=this.CLOSE;break;case"reloadButton":this.state=this.RELOAD;break;case"saveButton":this.isValid()?(this.onsave&&this.onsave(this.save()),this.state=this.CLOSE):this.state=this.PLAY}}onChange(){let t=1;for(let e=0;e<this.board.length;e++){let i=this.board.getItem(this.indexToCoord(e));i instanceof a&&(i.value=t++)}}isValid(){const t=[t=>{const e={errors:[],warnings:[]},i=Math.floor(.5*t.map.length),s=Math.floor(.7*t.map.length),o=t.map.reduce((t,e)=>"number"==typeof e?t+1:t,0);return o<i?e.errors.push(`Количество числовых тайлов должно быть не меньше ${i}, вы установили ${o}.`):o<s&&e.warnings.push(`Рекомендуемое количество числовых тайлов ${s} и выше, вы установили ${o}.`),e},t=>{const e={errors:[],warnings:[]},i=Math.floor(.1*t.map.length)||1,s=Math.floor(.3*t.map.length)||2,o=t.map.reduce((t,e)=>e?t:t+1,0);return o<i?e.errors.push(`Необходимо увеличить количество пустых ячеек с ${o} до ${i}.`):o>=s&&e.warnings.push(`Рекомендуемое количество пустых ячеек составляет ${s-1} и ниже, вы установили ${o}.`),e},t=>{const e={errors:[],warnings:[]},i=Math.floor(.1*t.map.length)||1,s=Math.floor(.25*t.map.length)||3,o=t.map.reduce((t,e)=>"string"==typeof e?t+1:t,0);return o<i?e.warnings.push(`Для интересной и насыщенной игры, рекомендуется установить ${i} неигровых тайлов, вы установили ${o}.`):o>=s&&e.errors.push(`Необходимо уменьшить количество неигровых тайлов с ${o} до ${s-1}.`),e},t=>{const e={errors:[],warnings:[]},i=t.rows,s=t.cols,o=["top","bottom","left","right","horizontal","vertical","all"],n=["top","bottom","vertical","all"],a=["left","right","horizontal","all"];return t.map.forEach((t,h)=>{const l=Math.floor(h/s),r=h%s;let c=null;return(0===l&&0===r||0===l&&r===s-1||l===i-1&&0===r||l===i-1&&r===s-1)&&o.includes(t)?(c=this.indexToCoord(h).map(t=>t+=1),void e.errors.push(`Не имеет смысла использовать неактивный тайл "${t}" в ячейке [${c}].`)):0!==l&&l!==i-1||!n.includes(t)?void(0!==r&&r!==s-1||a.includes(t)&&(c=this.indexToCoord(h).map(t=>t+=1),e.errors.push(`Не имеет смысла использовать неактивный тайл "${t}" в ячейке [${c}].`))):(c=this.indexToCoord(h).map(t=>t+=1),void e.errors.push(`Не имеет смысла использовать неактивный тайл "${t}" в ячейке [${c}].`))}),e},t=>{const e={errors:[],warnings:[]};return t.map.map((t,e)=>{if("string"==typeof t)return this.indexToCoord(e)}).filter(t=>!!t).forEach((t,i,s)=>{for(let o=i+1;o<s.length;o++){let i=s[o];(1===Math.abs(t[0]-i[0])&&t[1]===i[1]||1===Math.abs(t[1]-i[1])&&t[0]===i[0])&&e.warnings.push(`Будьте внимательны, устанавливая рядом неактивные тайлы в ячейках [${t.map(t=>t+=1)}] и [${i.map(t=>t+=1)}].`)}}),e}],e=this.save(),i=t.map(t=>t(e)).reduce((t,e)=>(e.errors&&(t.errors=[...t.errors,...e.errors]),e.warnings&&(t.warnings=[...t.warnings,...e.warnings]),t),{errors:[],warnings:[]});return console.log(`[errors]\n${i.errors.join("\n")}\n[warnings]\n${i.warnings.join("\n")}\n`),i.errors.length>0?(this.onerror&&this.onerror(i.errors.slice()),!1):!(i.warnings.length>0&&this.onwarning)||this.onwarning(i.warnings.slice())}change(t,e){const i=this.board,s=this.board.getItem(t),o=this.board.getItem(e),a=this.tokenPixelCoords(t),h=this.tokenPixelCoords(e);i.setItem(t,o),i.setItem(e,s),o&&o instanceof n&&(o.x=a[0],o.y=a[1]),s&&s instanceof n&&(s.x=h[0],s.y=h[1])}indexToCoord(t){return[Math.floor(t/this.board.cols),t%this.board.cols]}canvasPixelCoords(t){const e=t.target,i=e.offsetLeft,s=e.offsetTop;let o,n;return"touchstart"===t.type||"touchend"===t.type?(o=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(o=t.pageX,n=t.pageY),[o-i,n-s]}cellPixelCoords(t){const[e,i]=t;return[i*this.cellSize+this.canvasPadding,e*this.cellSize+this.canvasPadding+this.panelSize]}tokenPixelCoords(t){const[e,i]=this.cellPixelCoords(t);return[e+this.cellPadding,i+this.cellPadding]}hoverTokenCoords(t){const e=this.canvasPadding,i=this.canvas.height-e,s=this.canvas.width-e,o=this.cellPadding,n=this.tokenSize,a=this.panelSize;if(t[0]<e||t[1]<e+a||t[0]>s||t[1]>i)return null;const h=(t[0]-e)%(n+2*o),l=(t[1]-(e+a))%(n+2*o),r=Math.floor((t[0]-e)/(n+2*o)),c=Math.floor((t[1]-(e+a))/(n+2*o));return h>o&&l>o&&h<n+Math.floor(1.4*o)&&l<n+Math.floor(1.4*o)?[c,r]:null}hoverButtonName(t){const e=this.canvasPadding,i=this.canvas.width-e,s=this.panelSize,o=this.buttons;if(t[0]<e||t[1]<e||t[0]>i||t[1]>s)return null;for(let e in o){let i=o[e];if(i[0]<t[0]&&t[0]<i[0]+i[2]&&i[1]<t[1]&&t[1]<i[1]+i[3])return e}return null}_roundRect(t,e,i,s,o,n=5,a=!0,h=!0){if("number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var l={tl:0,tr:0,br:0,bl:0};for(var r in l)n[r]=n[r]||l[r]}t.beginPath(),t.moveTo(e+n.tl,i),t.lineTo(e+s-n.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+n.tr),t.lineTo(e+s,i+o-n.br),t.quadraticCurveTo(e+s,i+o,e+s-n.br,i+o),t.lineTo(e+n.bl,i+o),t.quadraticCurveTo(e,i+o,e,i+o-n.bl),t.lineTo(e,i+n.tl),t.quadraticCurveTo(e,i,e+n.tl,i),t.closePath(),a&&t.fill(),h&&t.stroke()}clearLocalData(){this.hoverToken=null,this.selected=null,this.changed=!0,this.state=null,this.panelSelectedToken=null,this.panelCurrentToken=0,this.eventQueue.length=0}destroy(){this.clearLocalData(),delete this.frameCallback,delete this._data,delete this.ctx,delete this.baseConfig,delete this.activeConfig,delete this.passiveConfig,delete this.panelConfig,delete this.counterConfig,delete this.timerConfig,this.board.destroy(),delete this.board,this.canvas.parentNode.removeChild(this.canvas),delete this.canvas,this.onclose&&this.onclose()}load(t){if(t||(t=this.initialBoard),!Array.isArray(t)||t.length!==this.board.length)throw RangeError(`CellsBuilder.load: the argument must be an Array(${this.board.length}), given (${Array.isArray(t)?t.length:typeof t})`);this._data=t;const e=this.baseConfig;t.forEach((t,i)=>{const s=this.indexToCoord(i),[o,a]=this.cellPixelCoords(s),[h,l]=this.tokenPixelCoords(s),r=this.board.getCell(s);r.label="?",r.x=o,r.y=a,r.token=n.create(t,{x:h,y:l,baseConfig:e})})}save(){const t={cols:this.board.cols,rows:this.board.rows,map:[]};for(let e=0;e<this.board.length;e++){let i=this.board.getItem(this.indexToCoord(e));t.map.push(n.toRaw(i))}return t}clear(){const t=this.ctx;t.shadowBlur=0,t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.canvas.width,this.canvas.height)}_drawButtonArc(t,e,i,s,o){t.beginPath(),t.fillStyle=e,t.moveTo(i,s),t.arc(i,s,o,0,2*Math.PI),t.fill(),t.closePath()}_drawPanelText(t,e,i,s,o,n,a){t.beginPath(),t.font=e,t.fillStyle=s,t.textAlign="center",t.textBaseline="middle",t.fillText(i,o,n,a),t.fill(),t.closePath()}drawPanel(t){const e=t.ctx,i=this.cellSize,s=this.panelFont,o=t.fontColor,n=this.panelButtonSize,h=this.buttonPadding,l=t.buttonColor,r=t.hoverButtonColor,c=this.hoverButton,d=t.iconColor,u=t.iconLineWidth,f=this.arrowButtonWidth,g=t.arrowWidth,b=t.arrowHeight,p=t.arrowLineWidth,S=this.buttonRadius;let v="decreaseRowsButton",w=this.buttons[v][0],C=this.buttons[v][1],m=w+S,k=C+S,T=c===v?r:l;this._drawButtonArc(e,T,m,k,S),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.moveTo(w+h,k),e.lineTo(w+n-h,k),e.stroke(),e.closePath(),C-=n,this._drawPanelText(e,s,this.board.rows,o,w+S,C+S,n),v="increaseRowsButton",w=this.buttons[v][0],k=(C=this.buttons[v][1])+S,T=c===v?r:l,this._drawButtonArc(e,T,m,k,S),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.moveTo(m,C+h),e.lineTo(m,C+n-h),e.moveTo(w+h,k),e.lineTo(w+n-h,k),e.stroke(),e.closePath(),C-=n,this._drawPanelText(e,s,"H",o,w+.5*n,C+.5*n,n),v="decreaseColsButton",m=(w=this.buttons[v][0])+S,k=(C=this.buttons[v][1])+S,T=c===v?r:l,this._drawButtonArc(e,T,m,k,S),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.moveTo(w+h,k),e.lineTo(w+n-h,k),e.stroke(),e.closePath(),C-=n,this._drawPanelText(e,s,this.board.cols,o,w+S,C+S,n),v="increaseColsButton",w=this.buttons[v][0],k=(C=this.buttons[v][1])+S,T=c===v?r:l,this._drawButtonArc(e,T,m,k,S),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.moveTo(m,C+h),e.lineTo(m,C+n-h),e.moveTo(w+h,k),e.lineTo(w+n-h,k),e.stroke(),e.closePath(),C-=n,this._drawPanelText(e,s,"W",o,w+.5*n,C+.5*n,n),w+=n,this._drawPanelText(e,s,"/",o,w+h,C+.5*n,2*h),v="leftArrowButton",w=this.buttons[v][0],C=this.buttons[v][1],m=w+Math.floor(.5*f),k=C+f,T=c===v?r:l,e.beginPath(),e.lineWidth=p,e.lineCap="round",e.strokeStyle=T,e.moveTo(m+Math.floor(.5*g),k-Math.floor(.5*b)),e.lineTo(m-Math.floor(.5*g),k),e.lineTo(m+Math.floor(.5*g),k+Math.floor(.5*b)),e.stroke(),e.closePath(),T=c===(v="setToken")?"#bbb":"#ccc",e.beginPath(),e.fillStyle=T,e.fillRect(w+f,C,i,i);const x=this.panelTokens[this.panelCurrentToken];if(x){let t=x instanceof a?this.activeConfig:this.passiveConfig;this.panelSelectedToken&&(t=Object.assign({},t,{tokenFillColor:"#8f8f8f"})),x.draw(t)}e.closePath(),v="rightArrowButton",w=this.buttons[v][0],C=this.buttons[v][1],m=w+Math.floor(.5*f),T=c===v?r:l,e.beginPath(),e.lineWidth=p,e.lineCap="round",e.strokeStyle=T,e.moveTo(m-Math.floor(.5*g),k-Math.floor(.5*b)),e.lineTo(m+Math.floor(.5*g),k),e.lineTo(m-Math.floor(.5*g),k+Math.floor(.5*b)),e.stroke(),e.closePath(),v="closeButton",m=(w=this.buttons[v][0])+S,k=(C=this.buttons[v][1])+S,T=c===v?r:l,e.beginPath(),e.fillStyle=T,e.arc(m,k,S,0,2*Math.PI),e.fill(),e.closePath(),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.moveTo(w+h,C+h),e.lineTo(w+n-h,C+n-h),e.moveTo(w+n-h,C+h),e.lineTo(w+h,C+n-h),e.stroke(),e.closePath(),v="reloadButton",w=this.buttons[v][0],C=this.buttons[v][1],m=w+S,T=c===v?r:l,e.beginPath(),e.fillStyle=T,e.arc(m,k,S,0,2*Math.PI),e.fill(),e.closePath(),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.arc(m,k,S-.8*h,.2*Math.PI,2*Math.PI-.4*Math.PI),e.stroke(),e.closePath(),v="saveButton",w=this.buttons[v][0],C=this.buttons[v][1],m=w+S,T=c===v?r:l,e.beginPath(),e.fillStyle=T,e.arc(m,k,S,0,2*Math.PI),e.fill(),e.closePath(),e.beginPath(),e.lineCap="round",e.strokeStyle=d,e.lineWidth=u,e.moveTo(w+h,C+1.5*h),e.lineTo(m,C+n-h),e.lineTo(w+n-h,C+h),e.stroke(),e.closePath(),e.lineWidth=t.bottomLineWidth,e.strokeStyle=t.bottomLineStrokeStyle,e.beginPath(),e.moveTo(0,t.bottomLineY),e.lineTo(this.canvas.width,t.bottomLineY),e.stroke(),e.closePath()}draw(){if(this.changed){this.changed=!1,this.clear(),this.drawPanel(this.panelConfig);for(let t=0,e=this.board.length;t<e;t++){const e=this.indexToCoord(t),i=this.board.getCell(e),s=i.token;if(i.draw(this.cellConfig),null===s)continue;const o={};let n={};s instanceof a?n=this.activeConfig:s instanceof h&&(n=this.passiveConfig);const l=this.selected;l&&l[0]===e[0]&&l[1]===e[1]&&(o.tokenFillColor="#8f8f8f");const r=this.hoverToken;r&&r[0]===e[0]&&r[1]===e[1]&&(o.tokenBorderColor="#aaa",o.tokenBorderWidth=Math.floor(.05*this.tokenSize)),Object.keys(o).length&&(n=Object.assign({},n,o)),s.draw(n)}}}update(){const t=this.eventQueue;if(t.length){for(this.changed=!0;t.length;){let e=t.shift();e&&e()}t.length=0}}frame(){switch(this.update(),this.draw(),this.state){case this.PLAY:this.frameDescriptor=window.requestAnimationFrame(this.frameCallback);break;case this.RELOAD:this.clearLocalData(),this.board.destroy(),this.board=new s(this.initialSize),this.load(this.initialBoard),this.refreshUI(),this.state=this.PLAY,this.frameDescriptor=window.requestAnimationFrame(this.frameCallback);break;case this.CLOSE:window.cancelAnimationFrame(this.frameDescriptor),this.destroy();break;default:throw new RangeError(`CellsBuilder.frame: incorrect game state "${this.state}"`)}}run(){this.onopen&&this.onopen(),this.state=this.PLAY,this.frameDescriptor=window.requestAnimationFrame(this.frameCallback)}};let f;if(confirm("Хотите сами создать карту?")){let t,e;(f=new u(null,{cellSize:80})).onsave=function(i){e=i,t=new d([i.rows,i.cols],{cellSize:80})},f.onclose=(()=>{t&&e?(t.onclose=(()=>{window.location.reload()}),t.mount("#app"),t.load(e.map),t.run()):window.location.reload()}),f.onerror=(t=>alert(`Ошибка\n\n${t.join("\n")}`)),f.onwarning=(t=>confirm(`Внимание\n\n${t.join("\n")}\n\nВсе равно сохранить карту?\n`)),f.mount("#app"),f.load(),f.run()}else{const t=[1,2,3,4,5,6,null,"bottom",7,"top",8,"vertical",null,9,10,11,null,"none",null,12,13,14,"horizontal",15,16];(f=new d([5,5],{cellSize:80})).onclose=(()=>{window.location.reload()}),f.mount("#app"),f.load(t),f.run()}}]);
//# sourceMappingURL=bundle.js.map